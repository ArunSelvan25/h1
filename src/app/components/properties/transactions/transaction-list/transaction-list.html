<div class="p-6 rounded-xl">
  <div class="flex justify-between">
    <div>  
      <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center gap-2">
        Transaction History
      </h2>
    </div>
    <div>  
      <button (click)="addTransaction(propertyService.viewedPropertyId())" class="ml-4 px-5 py-2 bg-primary hover:opacity-90 text-white text-sm rounded-lg transition font-semibold shadow-md cursor-pointer">
        Add transaction
      </button>
    </div>
  </div>


  <div class="overflow-x-auto rounded-lg border border-gray-200">
<table class="min-w-full divide-y divide-gray-200 text-sm">
  <thead class="bg-gray-50">
    <tr>
      <th class="px-6 py-3 text-left font-semibold text-gray-700">Date</th>
      <th class="px-6 py-3 text-left font-semibold text-gray-700">Amount</th>
      <th class="px-6 py-3 text-left font-semibold text-gray-700">Status</th>
      <th class="px-6 py-3 text-left font-semibold text-gray-700">Actions</th>
    </tr>
  </thead>
  <tbody class="bg-white divide-y divide-gray-200">
    @for (txn of propertyService.transactions(); track $index) {
      <!-- Parent Row -->
      <tr class="hover:bg-gray-50">
        <td (click)="toggleExpand($index)" class="px-6 py-4 whitespace-nowrap flex items-center gap-2 cursor-pointer">
          <span class="text-xl">
            @if (expandedRows.has($index)) { ▾ } @else { ▸ }
          </span>
          {{ txn.date | date: 'mediumDate' }}
        </td>
        <td class="px-6 py-4 whitespace-nowrap font-semibold text-green-700">
          ₹{{ txn.amount | number:'1.2-2' }}
        </td>
        <td class="px-6 py-4 whitespace-nowrap">
          <span
            [ngClass]="{
              'bg-green-100 text-green-700': txn.status === 'Paid',
              'bg-yellow-100 text-yellow-700': txn.status === 'Pending',
              'bg-red-100 text-red-700': txn.status === 'Failed'
            }"
            class="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold"
          >
            @if (txn.status === 'Paid') { ✅ }
            @if (txn.status === 'Pending') { ⏳ }
            @if (txn.status === 'Failed') { ❌ }
            {{ txn.status }}
          </span>
        </td>
        <td class="px-6 py-4 whitespace-nowrap relative">
          <div class="relative inline-block text-left">
            <!-- Change Status Button -->
            <button
              class="bg-primary text-white px-4 py-1.5 rounded-full text-xs font-medium shadow hover:bg-secondary transition"
              (click)="handleStatusButtonClick($event, $index)"
            >
              Change Status
            </button>

            <!-- Dropdown -->
            @if (openDropdownIndex === $index) {
              <div
                class="absolute z-[99] mt-2 w-40 right-0 origin-top-right bg-white border border-gray-200 rounded-md shadow-lg focus:outline-none flex flex-col"
                (clickOutside)="openDropdownIndex = null"
              >
                <button
                  class="w-full text-left px-4 py-2 text-sm hover:bg-gray-100"
                  [ngClass]="{ 'bg-green-100': txn.status === 'Paid' }"
                  (click)="changeTransactionStatus(txn, 'Paid'); openDropdownIndex = null"
                >
                  Paid
                </button>
                <button
                  class="w-full text-left px-4 py-2 text-sm hover:bg-gray-100"
                  [ngClass]="{ 'bg-yellow-100': txn.status === 'Pending' }"
                  (click)="changeTransactionStatus(txn, 'Pending'); openDropdownIndex = null"
                >
                  Pending
                </button>
                <button
                  class="w-full text-left px-4 py-2 text-sm hover:bg-gray-100"
                  [ngClass]="{ 'bg-red-100': txn.status === 'Failed' }"
                  (click)="changeTransactionStatus(txn, 'Failed'); openDropdownIndex = null"
                >
                  Failed
                </button>
              </div>
            }
          </div>
        </td>
      </tr>

      @if (txn.fields && expandedRows.has($index)) {
        <tr class="bg-gray-50">
          <td colspan="4" class="px-6 pb-4 pt-2 text-sm text-gray-700">
            <div class="bg-white border rounded-lg p-3">
              <h3 class="text-xs font-semibold text-gray-500 mb-2">Splitup</h3>
              <table class="min-w-full text-sm text-left border rounded-md overflow-hidden">
                <thead class="bg-gray-100 text-gray-600 font-medium">
                  <tr>
                    <th class="px-4 py-2 border-b border-gray-200">Field</th>
                    <th class="px-4 py-2 border-b border-gray-200">Amount</th>
                  </tr>
                </thead>
                <tbody>
                  @for (field of txn.fields | keyvalue; track field.key) {
                    <tr>
                      <td class="px-4 py-2 border-b border-gray-100">{{ field.key }}</td>
                      <td class="px-4 py-2 border-b border-gray-100 font-semibold text-gray-800">₹{{ field.value }}</td>
                    </tr>
                  }
                </tbody>
              </table>
            </div>
          </td>
        </tr>
      }
    }
  </tbody>
</table>

  </div>
</div>





